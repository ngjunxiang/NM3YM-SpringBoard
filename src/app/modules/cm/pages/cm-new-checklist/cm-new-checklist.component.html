<p-blockUI [blocked]=blocked></p-blockUI>
<p-confirmDialog></p-confirmDialog>

<div class="zoom" #form *ngIf="!loading">
    <div class="form-create" [formGroup]="newChecklistForm">
        <!-- Checklist Name -->
        <div style="padding-bottom: 10px" id="checklistName">
            <p-card styleClass="ui-card-shadow">
                <h4>Checklist Name</h4>
                <input type="text" id="input" style="width: 83%" class="form-control" placeholder="Enter Checklist Name"
                    formControlName="checklistName" required pInputText>
                <div class="error-inline-msg">
                    <span *ngIf="newChecklistForm.get('checklistName').dirty && newChecklistForm.get('checklistName').hasError('checklistNameExists')">
                        Checklist name exists
                    </span>
                </div>
            </p-card>
        </div>

        <!-- Required Fields -->
        <div style="padding-bottom: 10px">
            <p-card styleClass="ui-card-shadow">
                <h4>Required Fields</h4>
                <div formArrayName="requiredFields">
                    <div *ngFor="let field of newChecklistForm.get('requiredFields').controls; let i=index">
                        <h5>Field {{i+1}}</h5>
                        <div [formGroupName]="i" class="ui-g">
                            <div *ngIf="i < 4" class="ui-g-12 ui-md-10" style="margin-left: -8px">
                                <input type="text" id="input" class="form-control" style="display: inline-block; width: 92%"
                                    placeholder="Field (e.g. Client A/C Number)" formControlName="fieldName" pInputText>
                            </div>
                            <div *ngIf="i > 3" class="ui-g-12 ui-md-10" style="margin-left: -8px">
                                <input type="text" id="input" class="form-control" style="display: inline-block; width: 92%"
                                    placeholder="Field (e.g. Client A/C Number)" formControlName="fieldName" required
                                    pInputText>
                                <button pButton class="ui-button-danger" style="display: inline-block; width: 6%; margin-left: 2%"
                                    type="button" icon="fa fa-times" (click)="deleteField(i)"></button>
                                <div class="error-inline-msg">
                                    <span *ngIf="newChecklistForm.get('requiredFields').get(i + '').get('fieldName').dirty && newChecklistForm.get('requiredFields').get(i + '').get('fieldName').hasError('isDuplicate')">
                                        Duplicate required field
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <button pButton label="Add New Field" class="ui-button-success" style="width: 20%" type="button" icon="fa fa-plus"
                    (click)="addNewField()"></button>
            </p-card>
        </div>

        <!-- Checklist Conditions -->
        <div style="padding-bottom: 10px" id="conditions">
            <p-card styleClass="ui-card-shadow">

                <h4 style="display: inline-block;">
                    Checklist Conditions
                </h4>
                <p-dialog header="Information on Checklist Conditions" [(visible)]="cInfoDisplay" [closable]="true"
                    [maximizable]="true">
                    <font size="3">
                        <p>
                            <strong>Checklist conditions are tied to onboarding documents which are required under
                                certain conditions.</strong>
                            <br>
                            <i>E.G. Financial Intermediary Agreement is only required if Booking Center is Hong Kong.</i>
                        </p>
                        <br>
                        <p>
                            <strong>In the below image, it shows the creation of a Conditional Document which requires
                                its condition
                                parameters to be filled.</strong>
                        </p>
                        <img src="assets/images/CM_Cond_Info_Part_1.jpg" alt="Example of Condition" class="dark-logo"
                            style="border:1px solid grey; width: 500px; height: 250px" />
                        <br>
                        <br>
                        <p>
                            <strong>
                                To create the condition paramenters, you are required to fill in 'Condition' and
                                'Condition Options' as shown in the below
                                image.
                                <br> In the example below, there are 2 options, 'Singapore' and 'Hong Kong'.
                                <br> Each option needs be typed into the 'Condition Options' input field.
                                <br> Press Enter after writing each option.
                            </strong>
                        </p>
                        <img src="assets/images/CM_Cond_Info_Part_2.jpg" alt="Example of Condition" class="dark-logo"
                            style="border:1px solid grey; width: 500px; height: 150px" />
                        <br>
                        <br>
                        <p>
                            <strong>
                                The conditon parameters you have created will be reflected on the creation of
                                Conditional Document.
                            </strong>
                        </p>
                        <img src="assets/images/CM_Cond_Info_Part_3.jpg" alt="Example of Condition" class="dark-logo"
                            style="border:1px solid grey; width: 500px; height: 250px" />
                        <br>
                        <br>
                    </font>
                </p-dialog>
                <div style="float: right">
                    <button type="button" (click)="showCInfoDialog()" pButton icon="pi pi-info-circle" class="ui-button-rounded ui-button-info"
                        label="info"></button>
                </div>
                <br>
                <div formArrayName="conditions">
                    <div *ngFor="let condition of newChecklistForm.get('conditions').controls; let i=index">
                        <h5>Condition {{ i + 1 }}</h5>
                        <div [formGroupName]="i" class="ui-g">
                            <div style="margin-left: 0px; width: 100%;">
                                <input type="text" class="form-control" style="display: inline-block; width: 50%"
                                    placeholder="Condition (e.g. Booking Center)" formControlName="conditionName"
                                    required pInputText>
                                <button pButton [disabled]="newChecklistForm.get('conditions').length < 2 || newChecklistForm.get('conditions').get(i + '').get('conditionName').disabled"
                                    class="ui-button-danger" style="display: inline-block; width: 30px; margin-left: 2%"
                                    type="button" icon="fa fa-times" (click)="deleteCondition(i)"></button>
                                <p-chips placeholder="Condition Options* (e.g. Singapore, Hong Kong)" [allowDuplicate]="false"
                                    formControlName="conditionOptions" [addOnTab]="true" [addOnBlur]="true" class="invalid"
                                    *ngIf="newChecklistForm.get('conditions').get(i + '').get('conditionOptions').dirty && newChecklistForm.get('conditions').get(i + '').get('conditionOptions').errors?.required"></p-chips>
                                <p-chips placeholder="Condition Options* (e.g. Singapore, Hong Kong)" [allowDuplicate]="false"
                                    formControlName="conditionOptions" [addOnTab]="true" [addOnBlur]="true" *ngIf="!newChecklistForm.get('conditions').get(i + '').get('conditionOptions').dirty || !newChecklistForm.get('conditions').get(i + '').get('conditionOptions').errors?.required"></p-chips>
                                <p>
                                    *Input condition options by pressing 'enter'
                                </p>
                                <div class="error-inline-msg">
                                    <span *ngIf="newChecklistForm.get('conditions').get(i + '').get('conditionName').dirty && newChecklistForm.get('conditions').get(i + '').get('conditionName').hasError('isDuplicate')">
                                        Duplicate condition name
                                    </span>
                                </div>
                                <!-- Line Seperator -->
                                <hr *ngIf="i !== newChecklistForm.get('conditions').controls.length - 1">
                            </div>
                            <hr>
                        </div>
                    </div>
                </div>
                <button pButton label="Add New Condition" class="ui-button-success" style="width: 20%" type="button"
                    icon="fa fa-plus" (click)="addNewCondition()"></button>
            </p-card>
        </div>
    </div>

    <!-- Documents -->
    <div class="form-create" style="padding-bottom: 10px">
        <p-card styleClass="ui-card-shadow">
            <h4>Documents</h4>

            <!-- Compliance Documents -->
            <p-tabView [activeIndex]="activeTab" (onChange)="changeTab($event)">
                <p-tabPanel header="Compliance" leftIcon="fas fa-file-contract">
                    <h5>Mandatory</h5>
                    <div *ngIf="complianceDocumentsForm.get('mandatory').length === 0" style="padding-bottom:1%">
                        No documents yet
                    </div>
                    <div *ngIf="complianceDocumentsForm.get('mandatory').length !== 0" style="padding-bottom:1%">
                        <p-table [value]="complianceDocumentsForm.get('mandatory').controls" selectionMode="single">
                            <ng-template pTemplate="header">
                                <tr>
                                    <th *ngFor="let col of complianceCols" [ngClass]="col.field === 'documentName' ? 'cDocName' : 
                                                                            col.field === 'documentType' ? 'cDocType' :
                                                                            col.field === 'conditionName' ? 'cCondName' : 
                                                                            col.field === 'conditionOptions' ? 'cCondOption' : 
                                                                            col.field === 'agmtCode' ? 'cAgmtCode' :
                                                                            col.field === 'remarks' ? 'cRemark' :
                                                                            col.field === 'signature' ? 'cSignature' : null">
                                        {{col.header}}
                                    </th>
                                    <th style="width: 10%"></th>
                                </tr>
                            </ng-template>
                            <ng-template pTemplate="body" let-doc let-i="rowIndex">
                                <ng-container *ngIf="complianceDocumentsForm.get('mandatory').get(i + '').get('conditions')['length'] > 0">
                                    <ng-container *ngFor="let condition of complianceDocumentsForm.get('mandatory').get(i + '').get('conditions')['controls']; let j=index">
                                        <tr>
                                            <ng-container *ngIf="j === 0">
                                                <td [attr.rowspan]="complianceDocumentsForm.get('mandatory').get(i + '').get('conditions')['length']">{{
                                                    doc.get('documentName').value }}</td>
                                                <td [attr.rowspan]="complianceDocumentsForm.get('mandatory').get(i + '').get('conditions')['length']">{{
                                                    doc.get('documentType').value }}</td>
                                            </ng-container>
                                            <td>{{ condition.get('conditionName').value }}</td>
                                            <td>{{ condition.get('conditionOption').value }}</td>
                                            <ng-container *ngIf="j === 0">
                                                <td [attr.rowspan]="complianceDocumentsForm.get('mandatory').get(i + '').get('conditions')['length']">{{
                                                    doc.get('agmtCode').value }}</td>
                                                <td [attr.rowspan]="complianceDocumentsForm.get('mandatory').get(i + '').get('conditions')['length']"
                                                    [innerHTML]="doc.get('remarks').value"></td>
                                                <td *ngIf="doc.get('signature').value" [attr.rowspan]="complianceDocumentsForm.get('mandatory').get(i + '').get('conditions')['length']">
                                                    <i class="fa fa-check"></i>
                                                </td>
                                                <td *ngIf="!doc.get('signature').value" [attr.rowspan]="complianceDocumentsForm.get('mandatory').get(i + '').get('conditions')['length']">
                                                    <i class="fa fa-times"></i>
                                                </td>
                                                <td [attr.rowspan]="complianceDocumentsForm.get('mandatory').get(i + '').get('conditions')['length']">
                                                    <button pButton class="ui-button-warning" style="display: inline-block; width: 40%; margin-right:5%"
                                                        type="button" icon="fa fa-pencil" (click)="editDocument('mandatory', i)"></button>
                                                    <button pButton class="ui-button-danger" style="display: inline-block; width: 40%; margin-left:5%"
                                                        type="button" icon="fa fa-times" (click)="deleteDocument('mandatory', i)"></button>
                                                </td>
                                            </ng-container>
                                        </tr>
                                    </ng-container>
                                </ng-container>
                                <ng-container *ngIf="complianceDocumentsForm.get('mandatory').get(i + '').get('conditions')['length'] === 0">
                                    <tr>
                                        <td>{{
                                            doc.get('documentName').value }}</td>
                                        <td>{{
                                            doc.get('documentType').value }}</td>
                                        <td> - </td>
                                        <td> - </td>
                                        <td>{{
                                            doc.get('agmtCode').value }}</td>
                                        <td [innerHTML]="doc.get('remarks').value"></td>
                                        <td *ngIf="doc.get('signature').value">
                                            <i class="fa fa-check"></i>
                                        </td>
                                        <td *ngIf="!doc.get('signature').value">
                                            <i class="fa fa-times"></i>
                                        </td>
                                        <td>
                                            <button pButton class="ui-button-warning" style="display: inline-block; width: 40%; margin-right:5%"
                                                type="button" icon="fa fa-pencil" (click)="editDocument('mandatory', i)"></button>
                                            <button pButton class="ui-button-danger" style="display: inline-block; width: 40%; margin-left:5%"
                                                type="button" icon="fa fa-times" (click)="deleteDocument('mandatory', i)"></button>
                                        </td>
                                    </tr>
                                </ng-container>
                            </ng-template>
                        </p-table>
                    </div>

                    <button pButton label="Mandatory" class="ui-button-primary" style="display: inline-block; width: 20%"
                        type="button" icon="fa fa-plus" (click)="showDialog('mandatory')"></button>

                    <p-dialog [formGroup]="dialogForm" header="Add Mandatory Document" [(visible)]="mDisplay"
                        [closable]="false" [maximizable]="true" [width]="800">
                        <p-checkbox label="Does this document have conditions?" binary="true" formControlName="hasConditions"
                            (onChange)="toggleDocumentConditions($event)"></p-checkbox>
                        <div class="error-inline-msg">
                            <span *ngIf="dialogForm.get('hasConditions').disabled">
                                There are no existing checklist conditions
                            </span>
                        </div>

                        <br>

                        <ng-container *ngIf="dialogForm.get('hasConditions').enabled && dialogForm.get('hasConditions').value">
                            <h5>Conditions</h5>
                            <div formArrayName="conditions">
                                <div *ngFor="let condition of dialogForm.get('conditions').controls; let i=index">
                                    <div style="padding-top:1%" *ngIf="dialogForm.get('conditions')['length'] >= 0"
                                        [formGroupName]="i">
                                        <h6>Condition {{ i + 1 }}</h6>
                                        <div style="display: inline-block; margin-right:10px">
                                            <p-dropdown [options]="dropdownData.conditions" (onChange)="onDocumentConditionNameSelect($event.value, i)"
                                                placeholder="Select a condition" formControlName="conditionName"></p-dropdown>
                                        </div>
                                        <p-dropdown [options]="dropdownData.conditionOptions[i]" placeholder="Select a condition option"
                                            formControlName="conditionOption"></p-dropdown>
                                        <button pButton [disabled]="dialogForm.get('conditions')['length'] < 2" class="ui-button-danger"
                                            style="display: inline-block; width: 6%; margin-left: 2%" type="button"
                                            icon="fa fa-times" (click)="deleteDocumentCondition(i)"></button>
                                        <div class="error-inline-msg">
                                            <span *ngIf="dialogForm.get('conditions').get(i + '').get('conditionOption').dirty && dialogForm.get('conditions').get(i + '').get('conditionOption').hasError('isDuplicate')">
                                                Duplicate condition
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div style="padding-top:1%">
                                    <button pButton label="Add Condition" class="ui-button-success" style="display: inline-block; width: 35%"
                                        type="button" icon="fa fa-plus" (click)="addNewDocumentCondition()"></button>
                                </div>
                            </div>
                        </ng-container>

                        <h5>Agmt Code</h5>
                        <p-autoComplete [suggestions]="filteredAgmtCodes" (onSelect)="updateAgmtDocValues($event)"
                            (completeMethod)="searchAgmtCodes($event)" placeholder="Agmt Code" formControlName="agmtCode"
                            [style]="{'width':'90%', 'margin-bottom': '1%'}" [inputStyle]="{'width':'100%'}"
                            inputStyleClass="form-control"></p-autoComplete>
                        <div class="error-inline-msg">
                            <span *ngIf="dialogForm.get('agmtCode').dirty && dialogForm.get('agmtCode').hasError('isDuplicate')">
                                Duplicate agmt code
                            </span>
                        </div>

                        <h5>Document Name</h5>
                        <input type="text" id="input" class="form-control" placeholder="Document Name" formControlName="documentName"
                            required pInputText>

                        <div style="padding-top: 3%; padding-bottom: 4%">
                            <h5>Document Type</h5>
                            <p-dropdown [options]="documentTypeData" placeholder="Select a document type"
                                formControlName="documentType"></p-dropdown>
                        </div>

                        <h5>Remarks</h5>
                        <ngx-wig [formControl]="dialogForm.controls.remarks" [placeholder]="'Enter remarks here'"></ngx-wig>
                        <div class="ui-g" style="padding-right:4%">
                            <p-checkbox label="Signature required" binary="true" formControlName="signature"></p-checkbox>
                        </div>

                        <div class="ui-g" style="padding-top:2%">
                            <button pButton label="Add" class="ui-button-success" style="display: inline-block; width: 20%; margin-right:4%"
                                type="button" icon="fa fa-plus" (click)="addNewDocument('mandatory')"></button>
                            <button pButton label="Cancel" class="ui-button-danger" style="display: inline-block; width: 20%"
                                type="button" icon="fa fa-minus" (click)="cancelAddNewDocument()"></button>
                        </div>
                    </p-dialog>

                    <p-dialog [formGroup]="dialogForm" header="Edit Mandatory Document" [(visible)]="mEditDisplay"
                        [closable]="false" [maximizable]="true" [width]="800">
                        <p-checkbox label="Does this document have conditions?" binary="true" formControlName="hasConditions"
                            (onChange)="toggleDocumentConditions($event)"></p-checkbox>
                        <div class="error-inline-msg">
                            <span *ngIf="dialogForm.get('hasConditions').disabled">
                                There are no existing checklist conditions
                            </span>
                        </div>

                        <br>

                        <ng-container *ngIf="dialogForm.get('hasConditions').enabled && dialogForm.get('hasConditions').value">
                            <h5>Conditions</h5>
                            <div formArrayName="conditions">
                                <div *ngFor="let condition of dialogForm.get('conditions').controls; let i=index">
                                    <div style="padding-top:1%" *ngIf="dialogForm.get('conditions')['length'] >= 0"
                                        [formGroupName]="i">
                                        <h6>Condition {{ i + 1 }}</h6>
                                        <div style="display: inline-block; margin-right:10px">
                                            <p-dropdown [options]="dropdownData.conditions" (onChange)="onDocumentConditionNameSelect($event.value, i)"
                                                placeholder="Select a condition" formControlName="conditionName"></p-dropdown>
                                        </div>
                                        <p-dropdown [options]="dropdownData.conditionOptions[i]" placeholder="Select a condition option"
                                            formControlName="conditionOption"></p-dropdown>
                                        <button pButton [disabled]="dialogForm.get('conditions')['length'] < 2" class="ui-button-danger"
                                            style="display: inline-block; width: 6%; margin-left: 2%" type="button"
                                            icon="fa fa-times" (click)="deleteDocumentCondition(i)"></button>
                                        <div class="error-inline-msg">
                                            <span *ngIf="dialogForm.get('conditions').get(i + '').get('conditionOption').dirty && dialogForm.get('conditions').get(i + '').get('conditionOption').hasError('isDuplicate')">
                                                Duplicate condition
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div style="padding-top:1%">
                                    <button pButton label="Add Condition" class="ui-button-success" style="display: inline-block; width: 35%"
                                        type="button" icon="fa fa-plus" (click)="addNewDocumentCondition()"></button>
                                </div>
                            </div>
                        </ng-container>

                        <h5>Agmt Code</h5>
                        <p-autoComplete [suggestions]="filteredAgmtCodes" (onSelect)="updateAgmtDocValues($event)"
                            (completeMethod)="searchAgmtCodes($event)" placeholder="Agmt Code" formControlName="agmtCode"
                            [style]="{'width':'90%', 'margin-bottom': '1%'}" [inputStyle]="{'width':'100%'}"
                            inputStyleClass="form-control"></p-autoComplete>
                        <div class="error-inline-msg">
                            <span *ngIf="dialogForm.get('agmtCode').dirty && dialogForm.get('agmtCode').hasError('isDuplicate')">
                                Duplicate agmt code
                            </span>
                        </div>

                        <h5>Document Name</h5>
                        <input type="text" id="input" class="form-control" placeholder="Document Name" formControlName="documentName"
                            required pInputText>

                        <div style="padding-top: 3%; padding-bottom: 4%">
                            <h5>Document Type</h5>
                            <p-dropdown [options]="documentTypeData" placeholder="Select a document type"
                                formControlName="documentType"></p-dropdown>
                        </div>

                        <h5>Remarks</h5>
                        <ngx-wig [formControl]="dialogForm.controls.remarks" [placeholder]="'Enter remarks here'"></ngx-wig>
                        <div class="ui-g" style="padding-right:4%">
                            <p-checkbox label="Signature required" binary="true" formControlName="signature"></p-checkbox>
                        </div>

                        <div class="ui-g" style="padding-top:2%">
                            <button pButton label="Save" class="ui-button-success" style="display: inline-block; width: 20%; margin-right:4%"
                                type="button" icon="fa fa-plus" (click)="addNewDocument('mandatory')"></button>
                            <button pButton label="Cancel" class="ui-button-danger" style="display: inline-block; width: 20%"
                                type="button" icon="fa fa-minus" (click)="cancelAddNewDocument()"></button>
                        </div>
                    </p-dialog>

                    <h5>Optional</h5>
                    <div *ngIf="complianceDocumentsForm.get('optional').length === 0" style="padding-bottom:1%">
                        No documents yet
                    </div>
                    <div *ngIf="complianceDocumentsForm.get('optional').length !== 0" style="padding-bottom:1%">
                        <p-table [value]="complianceDocumentsForm.get('optional').controls" selectionMode="single">
                            <ng-template pTemplate="header">
                                <tr>
                                    <th *ngFor="let col of complianceCols" [ngClass]="col.field === 'documentName' ? 'cDocName' : 
                                                                            col.field === 'documentType' ? 'cDocType' :
                                                                            col.field === 'conditionName' ? 'cCondName' : 
                                                                            col.field === 'conditionOptions' ? 'cCondOption' : 
                                                                            col.field === 'agmtCode' ? 'cAgmtCode' :
                                                                            col.field === 'remarks' ? 'cRemark' :
                                                                            col.field === 'signature' ? 'cSignature' : null">
                                        {{col.header}}
                                    </th>
                                    <th style="width: 10%"></th>
                                </tr>
                            </ng-template>
                            <ng-template pTemplate="body" let-doc let-i="rowIndex">
                                <ng-container *ngIf="complianceDocumentsForm.get('optional').get(i + '').get('conditions')['length'] > 0">
                                    <ng-container *ngFor="let condition of complianceDocumentsForm.get('optional').get(i + '').get('conditions')['controls']; let j=index">
                                        <tr>
                                            <ng-container *ngIf="j === 0">
                                                <td [attr.rowspan]="complianceDocumentsForm.get('optional').get(i + '').get('conditions')['length']">{{
                                                    doc.get('documentName').value }}</td>
                                                <td [attr.rowspan]="complianceDocumentsForm.get('optional').get(i + '').get('conditions')['length']">{{
                                                    doc.get('documentType').value }}</td>
                                            </ng-container>
                                            <td>{{ condition.get('conditionName').value }}</td>
                                            <td>{{ condition.get('conditionOption').value }}</td>
                                            <ng-container *ngIf="j === 0">
                                                <td [attr.rowspan]="complianceDocumentsForm.get('optional').get(i + '').get('conditions')['length']">{{
                                                    doc.get('agmtCode').value }}</td>
                                                <td [attr.rowspan]="complianceDocumentsForm.get('optional').get(i + '').get('conditions')['length']"
                                                    [innerHTML]="doc.get('remarks').value"></td>
                                                <td *ngIf="doc.get('signature').value" [attr.rowspan]="complianceDocumentsForm.get('optional').get(i + '').get('conditions')['length']">
                                                    <i class="fa fa-check"></i>
                                                </td>
                                                <td *ngIf="!doc.get('signature').value" [attr.rowspan]="complianceDocumentsForm.get('optional').get(i + '').get('conditions')['length']">
                                                    <i class="fa fa-times"></i>
                                                </td>
                                                <td [attr.rowspan]="complianceDocumentsForm.get('optional').get(i + '').get('conditions')['length']">
                                                    <button pButton class="ui-button-warning" style="display: inline-block; width: 40%; margin-right:5%"
                                                        type="button" icon="fa fa-pencil" (click)="editDocument('optional', i)"></button>
                                                    <button pButton class="ui-button-danger" style="display: inline-block; width: 40%; margin-left:5%"
                                                        type="button" icon="fa fa-times" (click)="deleteDocument('optional', i)"></button>
                                                </td>
                                            </ng-container>
                                        </tr>
                                    </ng-container>
                                </ng-container>
                                <ng-container *ngIf="complianceDocumentsForm.get('optional').get(i + '').get('conditions')['length'] === 0">
                                    <tr>
                                        <td>{{
                                            doc.get('documentName').value }}</td>
                                        <td>{{
                                            doc.get('documentType').value }}</td>
                                        <td> - </td>
                                        <td> - </td>
                                        <td>{{
                                            doc.get('agmtCode').value }}</td>
                                        <td [innerHTML]="doc.get('remarks').value"></td>
                                        <td *ngIf="doc.get('signature').value">
                                            <i class="fa fa-check"></i>
                                        </td>
                                        <td *ngIf="!doc.get('signature').value">
                                            <i class="fa fa-times"></i>
                                        </td>
                                        <td>
                                            <button pButton class="ui-button-warning" style="display: inline-block; width: 40%; margin-right:5%"
                                                type="button" icon="fa fa-pencil" (click)="editDocument('optional', i)"></button>
                                            <button pButton class="ui-button-danger" style="display: inline-block; width: 40%; margin-left:5%"
                                                type="button" icon="fa fa-times" (click)="deleteDocument('optional', i)"></button>
                                        </td>
                                    </tr>
                                </ng-container>
                            </ng-template>
                        </p-table>
                    </div>

                    <button pButton label="Optional" class="cButton" style="display: inline-block; width: 20%"
                        type="button" icon="fa fa-plus" (click)="showDialog('optional')"></button>

                    <p-dialog [formGroup]="dialogForm" header="Add Optional Document" [(visible)]="oDisplay" [closable]="false"
                        [maximizable]="true" [width]="800">
                        <p-checkbox label="Does this document have conditions?" binary="true" formControlName="hasConditions"
                            (onChange)="toggleDocumentConditions($event)"></p-checkbox>
                        <div class="error-inline-msg">
                            <span *ngIf="dialogForm.get('hasConditions').disabled">
                                There are no existing checklist conditions
                            </span>
                        </div>

                        <br>

                        <ng-container *ngIf="dialogForm.get('hasConditions').enabled && dialogForm.get('hasConditions').value">
                            <h5>Conditions</h5>
                            <div formArrayName="conditions">
                                <div *ngFor="let condition of dialogForm.get('conditions').controls; let i=index">
                                    <div style="padding-top:1%" *ngIf="dialogForm.get('conditions')['length'] >= 0"
                                        [formGroupName]="i">
                                        <h6>Condition {{ i + 1 }}</h6>
                                        <div style="display: inline-block; margin-right:10px">
                                            <p-dropdown [options]="dropdownData.conditions" (onChange)="onDocumentConditionNameSelect($event.value, i)"
                                                placeholder="Select a condition" formControlName="conditionName"></p-dropdown>
                                        </div>
                                        <p-dropdown [options]="dropdownData.conditionOptions[i]" placeholder="Select a condition option"
                                            formControlName="conditionOption"></p-dropdown>
                                        <button pButton [disabled]="dialogForm.get('conditions')['length'] < 2" class="ui-button-danger"
                                            style="display: inline-block; width: 6%; margin-left: 2%" type="button"
                                            icon="fa fa-times" (click)="deleteDocumentCondition(i)"></button>
                                        <div class="error-inline-msg">
                                            <span *ngIf="dialogForm.get('conditions').get(i + '').get('conditionOption').dirty && dialogForm.get('conditions').get(i + '').get('conditionOption').hasError('isDuplicate')">
                                                Duplicate condition
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div style="padding-top:1%">
                                    <button pButton label="Add Condition" class="ui-button-success" style="display: inline-block; width: 35%"
                                        type="button" icon="fa fa-plus" (click)="addNewDocumentCondition()"></button>
                                </div>
                            </div>
                        </ng-container>

                        <h5>Agmt Code</h5>
                        <p-autoComplete [suggestions]="filteredAgmtCodes" (onSelect)="updateAgmtDocValues($event)"
                            (completeMethod)="searchAgmtCodes($event)" placeholder="Agmt Code" formControlName="agmtCode"
                            [style]="{'width':'90%', 'margin-bottom': '1%'}" [inputStyle]="{'width':'100%'}"
                            inputStyleClass="form-control"></p-autoComplete>
                        <div class="error-inline-msg">
                            <span *ngIf="dialogForm.get('agmtCode').dirty && dialogForm.get('agmtCode').hasError('isDuplicate')">
                                Duplicate agmt code
                            </span>
                        </div>

                        <h5>Document Name</h5>
                        <input type="text" id="input" class="form-control" placeholder="Document Name" formControlName="documentName"
                            required pInputText>

                        <div style="padding-top: 3%; padding-bottom: 4%">
                            <h5>Document Type</h5>
                            <p-dropdown [options]="documentTypeData" placeholder="Select a document type"
                                formControlName="documentType"></p-dropdown>
                        </div>

                        <h5>Remarks</h5>
                        <ngx-wig [formControl]="dialogForm.controls.remarks" [placeholder]="'Enter remarks here'"></ngx-wig>
                        <div class="ui-g" style="padding-right:4%">
                            <p-checkbox label="Signature required" binary="true" formControlName="signature"></p-checkbox>
                        </div>

                        <div class="ui-g" style="padding-top:2%">
                            <button pButton label="Add" class="ui-button-success" style="display: inline-block; width: 20%; margin-right:4%"
                                type="button" icon="fa fa-plus" (click)="addNewDocument('optional')"></button>
                            <button pButton label="Cancel" class="ui-button-danger" style="display: inline-block; width: 20%"
                                type="button" icon="fa fa-minus" (click)="cancelAddNewDocument()"></button>
                        </div>
                    </p-dialog>

                    <p-dialog [formGroup]="dialogForm" header="Edit Optional Document" [(visible)]="oEditDisplay"
                        [closable]="false" [maximizable]="true" [width]="800">
                        <p-checkbox label="Does this document have conditions?" binary="true" formControlName="hasConditions"
                            (onChange)="toggleDocumentConditions($event)"></p-checkbox>
                        <div class="error-inline-msg">
                            <span *ngIf="dialogForm.get('hasConditions').disabled">
                                There are no existing checklist conditions
                            </span>
                        </div>

                        <br>

                        <ng-container *ngIf="dialogForm.get('hasConditions').enabled && dialogForm.get('hasConditions').value">
                            <h5>Conditions</h5>
                            <div formArrayName="conditions">
                                <div *ngFor="let condition of dialogForm.get('conditions').controls; let i=index">
                                    <div style="padding-top:1%" *ngIf="dialogForm.get('conditions')['length'] >= 0"
                                        [formGroupName]="i">
                                        <h6>Condition {{ i + 1 }}</h6>
                                        <div style="display: inline-block; margin-right:10px">
                                            <p-dropdown [options]="dropdownData.conditions" (onChange)="onDocumentConditionNameSelect($event.value, i)"
                                                placeholder="Select a condition" formControlName="conditionName"></p-dropdown>
                                        </div>
                                        <p-dropdown [options]="dropdownData.conditionOptions[i]" placeholder="Select a condition option"
                                            formControlName="conditionOption"></p-dropdown>
                                        <button pButton [disabled]="dialogForm.get('conditions')['length'] < 2" class="ui-button-danger"
                                            style="display: inline-block; width: 6%; margin-left: 2%" type="button"
                                            icon="fa fa-times" (click)="deleteDocumentCondition(i)"></button>
                                        <div class="error-inline-msg">
                                            <span *ngIf="dialogForm.get('conditions').get(i + '').get('conditionOption').dirty && dialogForm.get('conditions').get(i + '').get('conditionOption').hasError('isDuplicate')">
                                                Duplicate condition
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div style="padding-top:1%">
                                    <button pButton label="Add Condition" class="ui-button-success" style="display: inline-block; width: 35%"
                                        type="button" icon="fa fa-plus" (click)="addNewDocumentCondition()"></button>
                                </div>
                            </div>
                        </ng-container>

                        <h5>Agmt Code</h5>
                        <p-autoComplete [suggestions]="filteredAgmtCodes" (onSelect)="updateAgmtDocValues($event)"
                            (completeMethod)="searchAgmtCodes($event)" placeholder="Agmt Code" formControlName="agmtCode"
                            [style]="{'width':'90%', 'margin-bottom': '1%'}" [inputStyle]="{'width':'100%'}"
                            inputStyleClass="form-control"></p-autoComplete>
                        <div class="error-inline-msg">
                            <span *ngIf="dialogForm.get('agmtCode').dirty && dialogForm.get('agmtCode').hasError('isDuplicate')">
                                Duplicate agmt code
                            </span>
                        </div>

                        <h5>Document Name</h5>
                        <input type="text" id="input" class="form-control" placeholder="Document Name" formControlName="documentName"
                            required pInputText>

                        <div style="padding-top: 3%; padding-bottom: 4%">
                            <h5>Document Type</h5>
                            <p-dropdown [options]="documentTypeData" placeholder="Select a document type"
                                formControlName="documentType"></p-dropdown>
                        </div>

                        <h5>Remarks</h5>
                        <ngx-wig [formControl]="dialogForm.controls.remarks" [placeholder]="'Enter remarks here'"></ngx-wig>
                        <div class="ui-g" style="padding-right:4%">
                            <p-checkbox label="Signature required" binary="true" formControlName="signature"></p-checkbox>
                        </div>

                        <div class="ui-g" style="padding-top:2%">
                            <button pButton label="Save" class="ui-button-success" style="display: inline-block; width: 20%; margin-right:4%"
                                type="button" icon="fa fa-plus" (click)="addNewDocument('optional')"></button>
                            <button pButton label="Cancel" class="ui-button-danger" style="display: inline-block; width: 20%"
                                type="button" icon="fa fa-minus" (click)="cancelAddNewDocument()"></button>
                        </div>
                    </p-dialog>
                </p-tabPanel>


                <!-- Legal Documents -->
                <p-tabPanel header="Legal" leftIcon="fa fa-balance-scale">
                    <h5>Mandatory</h5>
                    <div *ngIf="legalDocumentsForm.get('mandatory').length === 0" style="padding-bottom:1%">
                        No documents yet
                    </div>
                    <div *ngIf="legalDocumentsForm.get('mandatory').length !== 0" style="padding-bottom:1%">
                        <p-table [value]="legalDocumentsForm.get('mandatory').controls" selectionMode="single">
                            <ng-template pTemplate="header">
                                <tr>
                                    <th *ngFor="let col of legalCols" [ngClass]="col.field === 'documentName' ? 'lDocName' : 
                                                                                            col.field === 'documentType' ? 'lDocType' :
                                                                                            col.field === 'conditionName' ? 'lCondName' : 
                                                                                            col.field === 'conditionOptions' ? 'lCondOption' : 
                                                                                            col.field === 'agmtCode' ? 'lAgmtCode' :
                                                                                            col.field === 'remarks' ? 'lRemark' :
                                                                                            col.field === 'signature' ? 'lSignature' : 
                                                                                            col.field === 'canWaiver' ? 'lWaiver' : null">
                                        {{col.header}}
                                    </th>
                                    <th style="width: 10%"></th>
                                </tr>
                            </ng-template>
                            <ng-template pTemplate="body" let-doc let-i="rowIndex">
                                <ng-container *ngIf="legalDocumentsForm.get('mandatory').get(i + '').get('conditions')['length'] > 0">
                                    <ng-container *ngFor="let condition of legalDocumentsForm.get('mandatory').get(i + '').get('conditions')['controls']; let j=index">
                                        <tr>
                                            <ng-container *ngIf="j === 0">
                                                <td [attr.rowspan]="legalDocumentsForm.get('mandatory').get(i + '').get('conditions')['length']">{{
                                                    doc.get('documentName').value }}</td>
                                                <td [attr.rowspan]="complianceDocumentsForm.get('mandatory').get(i + '').get('conditions')['length']">{{
                                                    doc.get('documentType').value }}</td>
                                            </ng-container>
                                            <td>{{ condition.get('conditionName').value }}</td>
                                            <td>{{ condition.get('conditionOption').value }}</td>
                                            <ng-container *ngIf="j === 0">
                                                <td [attr.rowspan]="legalDocumentsForm.get('mandatory').get(i + '').get('conditions')['length']">{{
                                                    doc.get('agmtCode').value }}</td>
                                                <td [attr.rowspan]="legalDocumentsForm.get('mandatory').get(i + '').get('conditions')['length']"
                                                    [innerHTML]="doc.get('remarks').value"></td>
                                                <td *ngIf="doc.get('signature').value" [attr.rowspan]="legalDocumentsForm.get('mandatory').get(i + '').get('conditions')['length']">
                                                    <i class="fa fa-check"></i>
                                                </td>
                                                <td *ngIf="!doc.get('signature').value" [attr.rowspan]="legalDocumentsForm.get('mandatory').get(i + '').get('conditions')['length']">
                                                    <i class="fa fa-times"></i>
                                                </td>
                                                <td *ngIf="doc.get('canWaiver').value" [attr.rowspan]="legalDocumentsForm.get('mandatory').get(i + '').get('conditions')['length']">
                                                    <i class="fa fa-check"></i>
                                                </td>
                                                <td *ngIf="!doc.get('canWaiver').value" [attr.rowspan]="legalDocumentsForm.get('mandatory').get(i + '').get('conditions')['length']">
                                                    <i class="fa fa-times"></i>
                                                </td>
                                                <td [attr.rowspan]="legalDocumentsForm.get('mandatory').get(i + '').get('conditions')['length']">
                                                    <button pButton class="ui-button-warning" style="display: inline-block; width: 40%; margin-right:5%"
                                                        type="button" icon="fa fa-pencil" (click)="editDocument('mandatory', i)"></button>
                                                    <button pButton class="ui-button-danger" style="display: inline-block; width: 40%; margin-left:5%"
                                                        type="button" icon="fa fa-times" (click)="deleteDocument('mandatory', i)"></button>
                                                </td>
                                            </ng-container>
                                        </tr>
                                    </ng-container>
                                </ng-container>
                                <ng-container *ngIf="legalDocumentsForm.get('mandatory').get(i + '').get('conditions')['length'] === 0">
                                    <tr>
                                        <td>{{
                                            doc.get('documentName').value }}</td>
                                        <td>{{
                                            doc.get('documentType').value }}</td>
                                        <td> - </td>
                                        <td> - </td>
                                        <td>{{
                                            doc.get('agmtCode').value }}</td>
                                        <td [innerHTML]="doc.get('remarks').value"></td>
                                        <td *ngIf="doc.get('signature').value">
                                            <i class="fa fa-check"></i>
                                        </td>
                                        <td *ngIf="!doc.get('signature').value">
                                            <i class="fa fa-times"></i>
                                        </td>
                                        <td *ngIf="doc.get('canWaiver').value">
                                            <i class="fa fa-check"></i>
                                        </td>
                                        <td *ngIf="!doc.get('canWaiver').value">
                                            <i class="fa fa-times"></i>
                                        </td>
                                        <td>
                                            <button pButton class="ui-button-warning" style="display: inline-block; width: 40%; margin-right:5%"
                                                type="button" icon="fa fa-pencil" (click)="editDocument('mandatory', i)"></button>
                                            <button pButton class="ui-button-danger" style="display: inline-block; width: 40%; margin-left:5%"
                                                type="button" icon="fa fa-times" (click)="deleteDocument('mandatory', i)"></button>
                                        </td>
                                    </tr>
                                </ng-container>
                            </ng-template>
                        </p-table>
                    </div>

                    <button pButton label="Mandatory" class="ui-button-primary" style="display: inline-block; width: 20%"
                        type="button" icon="fa fa-plus" (click)="showDialog('mandatory')"></button>

                    <p-dialog [formGroup]="dialogForm" header="Add Mandatory Document" [(visible)]="mDisplay"
                        [closable]="false" [maximizable]="true" [width]="800">
                        <p-checkbox label="Does this document have conditions?" binary="true" formControlName="hasConditions"
                            (onChange)="toggleDocumentConditions($event)"></p-checkbox>
                        <div class="error-inline-msg">
                            <span *ngIf="dialogForm.get('hasConditions').disabled">
                                There are no existing checklist conditions
                            </span>
                        </div>

                        <br>

                        <ng-container *ngIf="dialogForm.get('hasConditions').enabled && dialogForm.get('hasConditions').value">
                            <h5>Conditions</h5>
                            <div formArrayName="conditions">
                                <div *ngFor="let condition of dialogForm.get('conditions').controls; let i=index">
                                    <div style="padding-top:1%" *ngIf="dialogForm.get('conditions')['length'] >= 0"
                                        [formGroupName]="i">
                                        <h6>Condition {{ i + 1 }}</h6>
                                        <div style="display: inline-block; margin-right:10px">
                                            <p-dropdown [options]="dropdownData.conditions" (onChange)="onDocumentConditionNameSelect($event.value, i)"
                                                placeholder="Select a condition" formControlName="conditionName"></p-dropdown>
                                        </div>
                                        <p-dropdown [options]="dropdownData.conditionOptions[i]" placeholder="Select a condition option"
                                            formControlName="conditionOption"></p-dropdown>
                                        <button pButton [disabled]="dialogForm.get('conditions')['length'] < 2" class="ui-button-danger"
                                            style="display: inline-block; width: 6%; margin-left: 2%" type="button"
                                            icon="fa fa-times" (click)="deleteDocumentCondition(i)"></button>
                                        <div class="error-inline-msg">
                                            <span *ngIf="dialogForm.get('conditions').get(i + '').get('conditionOption').dirty && dialogForm.get('conditions').get(i + '').get('conditionOption').hasError('isDuplicate')">
                                                Duplicate condition
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div style="padding-top:1%">
                                    <button pButton label="Add Condition" class="ui-button-success" style="display: inline-block; width: 35%"
                                        type="button" icon="fa fa-plus" (click)="addNewDocumentCondition()"></button>
                                </div>
                            </div>
                        </ng-container>

                        <h5>Agmt Code</h5>
                        <p-autoComplete [suggestions]="filteredAgmtCodes" (onSelect)="updateAgmtDocValues($event)"
                            (completeMethod)="searchAgmtCodes($event)" placeholder="Agmt Code" formControlName="agmtCode"
                            [style]="{'width':'90%', 'margin-bottom': '1%'}" [inputStyle]="{'width':'100%'}"
                            inputStyleClass="form-control"></p-autoComplete>
                        <div class="error-inline-msg">
                            <span *ngIf="dialogForm.get('agmtCode').dirty && dialogForm.get('agmtCode').hasError('isDuplicate')">
                                Duplicate agmt code
                            </span>
                        </div>

                        <h5>Document Name</h5>
                        <input type="text" id="input" class="form-control" placeholder="Document Name" formControlName="documentName"
                            required pInputText>

                        <div style="padding-top: 3%; padding-bottom: 4%">
                            <h5>Document Type</h5>
                            <p-dropdown [options]="documentTypeData" placeholder="Select a document type"
                                formControlName="documentType"></p-dropdown>
                        </div>

                        <h5>Remarks</h5>
                        <ngx-wig [formControl]="dialogForm.controls.remarks" [placeholder]="'Enter remarks here'"></ngx-wig>

                        <div class="ui-g" style="padding-right: 4%; padding-top: 2%; padding-bottom: 2%">
                            <p-checkbox label="Signature required" binary="true" formControlName="signature"></p-checkbox>
                        </div>
                        <div class="ui-g">
                            <p-checkbox label="Can be waived" binary="true" formControlName="canWaiver"></p-checkbox>
                        </div>

                        <div class="ui-g" style="padding-top:2%">
                            <button pButton label="Add" class="ui-button-success" style="display: inline-block; width: 20%; margin-right:4%"
                                type="button" icon="fa fa-plus" (click)="addNewDocument('mandatory')"></button>
                            <button pButton label="Cancel" class="ui-button-danger" style="display: inline-block; width: 20%"
                                type="button" icon="fa fa-minus" (click)="cancelAddNewDocument()"></button>
                        </div>
                    </p-dialog>

                    <p-dialog [formGroup]="dialogForm" header="Edit Mandatory Document" [(visible)]="mEditDisplay"
                        [closable]="false" [maximizable]="true" [width]="800">
                        <p-checkbox label="Does this document have conditions?" binary="true" formControlName="hasConditions"
                            (onChange)="toggleDocumentConditions($event)"></p-checkbox>
                        <div class="error-inline-msg">
                            <span *ngIf="dialogForm.get('hasConditions').disabled">
                                There are no existing checklist conditions
                            </span>
                        </div>

                        <br>

                        <ng-container *ngIf="dialogForm.get('hasConditions').enabled && dialogForm.get('hasConditions').value">
                            <h5>Conditions</h5>
                            <div formArrayName="conditions">
                                <div *ngFor="let condition of dialogForm.get('conditions').controls; let i=index">
                                    <div style="padding-top:1%" *ngIf="dialogForm.get('conditions')['length'] >= 0"
                                        [formGroupName]="i">
                                        <h6>Condition {{ i + 1 }}</h6>
                                        <div style="display: inline-block; margin-right:10px">
                                            <p-dropdown [options]="dropdownData.conditions" (onChange)="onDocumentConditionNameSelect($event.value, i)"
                                                placeholder="Select a condition" formControlName="conditionName"></p-dropdown>
                                        </div>
                                        <p-dropdown [options]="dropdownData.conditionOptions[i]" placeholder="Select a condition option"
                                            formControlName="conditionOption"></p-dropdown>
                                        <button pButton [disabled]="dialogForm.get('conditions')['length'] < 2" class="ui-button-danger"
                                            style="display: inline-block; width: 6%; margin-left: 2%" type="button"
                                            icon="fa fa-times" (click)="deleteDocumentCondition(i)"></button>
                                        <div class="error-inline-msg">
                                            <span *ngIf="dialogForm.get('conditions').get(i + '').get('conditionOption').dirty && dialogForm.get('conditions').get(i + '').get('conditionOption').hasError('isDuplicate')">
                                                Duplicate condition
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div style="padding-top:1%">
                                    <button pButton label="Add Condition" class="ui-button-success" style="display: inline-block; width: 35%"
                                        type="button" icon="fa fa-plus" (click)="addNewDocumentCondition()"></button>
                                </div>
                            </div>
                        </ng-container>

                        <h5>Agmt Code</h5>
                        <p-autoComplete [suggestions]="filteredAgmtCodes" (onSelect)="updateAgmtDocValues($event)"
                            (completeMethod)="searchAgmtCodes($event)" placeholder="Agmt Code" formControlName="agmtCode"
                            [style]="{'width':'90%', 'margin-bottom': '1%'}" [inputStyle]="{'width':'100%'}"
                            inputStyleClass="form-control"></p-autoComplete>
                        <div class="error-inline-msg">
                            <span *ngIf="dialogForm.get('agmtCode').dirty && dialogForm.get('agmtCode').hasError('isDuplicate')">
                                Duplicate agmt code
                            </span>
                        </div>

                        <h5>Document Name</h5>
                        <input type="text" id="input" class="form-control" placeholder="Document Name" formControlName="documentName"
                            required pInputText>

                        <div style="padding-top: 3%; padding-bottom: 4%">
                            <h5>Document Type</h5>
                            <p-dropdown [options]="documentTypeData" placeholder="Select a document type"
                                formControlName="documentType"></p-dropdown>
                        </div>

                        <h5>Remarks</h5>
                        <ngx-wig [formControl]="dialogForm.controls.remarks" [placeholder]="'Enter remarks here'"></ngx-wig>

                        <div class="ui-g" style="padding-right: 4%; padding-top: 2%; padding-bottom: 2%">
                            <p-checkbox label="Signature required" binary="true" formControlName="signature"></p-checkbox>
                        </div>
                        <div class="ui-g">
                            <p-checkbox label="Can be waived" binary="true" formControlName="canWaiver"></p-checkbox>
                        </div>

                        <div class="ui-g" style="padding-top:2%">
                            <button pButton label="Save" class="ui-button-success" style="display: inline-block; width: 20%; margin-right:4%"
                                type="button" icon="fa fa-plus" (click)="addNewDocument('mandatory')"></button>
                            <button pButton label="Cancel" class="ui-button-danger" style="display: inline-block; width: 20%"
                                type="button" icon="fa fa-minus" (click)="cancelAddNewDocument()"></button>
                        </div>
                    </p-dialog>

                    <h5>Optional</h5>
                    <div *ngIf="legalDocumentsForm.get('optional').length === 0" style="padding-bottom:1%">
                        No documents yet
                    </div>
                    <div *ngIf="legalDocumentsForm.get('optional').length !== 0" style="padding-bottom:1%">
                        <p-table [value]="legalDocumentsForm.get('optional').controls" selectionMode="single">
                            <ng-template pTemplate="header">
                                <tr>
                                    <th *ngFor="let col of legalCols" [ngClass]="col.field === 'documentName' ? 'lDocName' : 
                                                                                            col.field === 'documentType' ? 'lDocType' :
                                                                                            col.field === 'conditionName' ? 'lCondName' : 
                                                                                            col.field === 'conditionOptions' ? 'lCondOption' : 
                                                                                            col.field === 'agmtCode' ? 'lAgmtCode' :
                                                                                            col.field === 'remarks' ? 'lRemark' :
                                                                                            col.field === 'signature' ? 'lSignature' : 
                                                                                            col.field === 'canWaiver' ? 'lWaiver' : null">
                                        {{col.header}}
                                    </th>
                                    <th style="width: 10%"></th>
                                </tr>
                            </ng-template>
                            <ng-template pTemplate="body" let-doc let-i="rowIndex">
                                <ng-container *ngIf="legalDocumentsForm.get('optional').get(i + '').get('conditions')['length'] > 0">
                                    <ng-container *ngFor="let condition of legalDocumentsForm.get('optional').get(i + '').get('conditions')['controls']; let j=index">
                                        <tr>
                                            <ng-container *ngIf="j === 0">
                                                <td [attr.rowspan]="legalDocumentsForm.get('optional').get(i + '').get('conditions')['length']">{{
                                                    doc.get('documentName').value }}</td>
                                                <td [attr.rowspan]="legalDocumentsForm.get('optional').get(i + '').get('conditions')['length']">{{
                                                    doc.get('documentType').value }}</td>
                                            </ng-container>
                                            <td>{{ condition.get('conditionName').value }}</td>
                                            <td>{{ condition.get('conditionOption').value }}</td>
                                            <ng-container *ngIf="j === 0">
                                                <td [attr.rowspan]="legalDocumentsForm.get('optional').get(i + '').get('conditions')['length']">{{
                                                    doc.get('agmtCode').value }}</td>
                                                <td [attr.rowspan]="legalDocumentsForm.get('optional').get(i + '').get('conditions')['length']"
                                                    [innerHTML]="doc.get('remarks').value"></td>
                                                <td *ngIf="doc.get('signature').value" [attr.rowspan]="legalDocumentsForm.get('optional').get(i + '').get('conditions')['length']">
                                                    <i class="fa fa-check"></i>
                                                </td>
                                                <td *ngIf="!doc.get('signature').value" [attr.rowspan]="legalDocumentsForm.get('optional').get(i + '').get('conditions')['length']">
                                                    <i class="fa fa-times"></i>
                                                </td>
                                                <td *ngIf="doc.get('canWaiver').value" [attr.rowspan]="legalDocumentsForm.get('optional').get(i + '').get('conditions')['length']">
                                                    <i class="fa fa-check"></i>
                                                </td>
                                                <td *ngIf="!doc.get('canWaiver').value" [attr.rowspan]="legalDocumentsForm.get('optional').get(i + '').get('conditions')['length']">
                                                    <i class="fa fa-times"></i>
                                                </td>
                                                <td [attr.rowspan]="legalDocumentsForm.get('optional').get(i + '').get('conditions')['length']">
                                                    <button pButton class="ui-button-warning" style="display: inline-block; width: 40%; margin-right:5%"
                                                        type="button" icon="fa fa-pencil" (click)="editDocument('optional', i)"></button>
                                                    <button pButton class="ui-button-danger" style="display: inline-block; width: 40%; margin-left:5%"
                                                        type="button" icon="fa fa-times" (click)="deleteDocument('optional', i)"></button>
                                                </td>
                                            </ng-container>
                                        </tr>
                                    </ng-container>
                                </ng-container>
                                <ng-container *ngIf="legalDocumentsForm.get('optional').get(i + '').get('conditions')['length'] === 0">
                                    <tr>
                                        <td>{{
                                            doc.get('documentName').value }}</td>
                                        <td>{{
                                            doc.get('documentType').value }}</td>
                                        <td> - </td>
                                        <td> - </td>
                                        <td>{{
                                            doc.get('agmtCode').value }}</td>
                                        <td [innerHTML]="doc.get('remarks').value"></td>
                                        <td *ngIf="doc.get('signature').value">
                                            <i class="fa fa-check"></i>
                                        </td>
                                        <td *ngIf="!doc.get('signature').value">
                                            <i class="fa fa-times"></i>
                                        </td>
                                        <td *ngIf="doc.get('canWaiver').value">
                                            <i class="fa fa-check"></i>
                                        </td>
                                        <td *ngIf="!doc.get('canWaiver').value">
                                            <i class="fa fa-times"></i>
                                        </td>
                                        <td>
                                            <button pButton class="ui-button-warning" style="display: inline-block; width: 40%; margin-right:5%"
                                                type="button" icon="fa fa-pencil" (click)="editDocument('optional', i)"></button>
                                            <button pButton class="ui-button-danger" style="display: inline-block; width: 40%; margin-left:5%"
                                                type="button" icon="fa fa-times" (click)="deleteDocument('optional', i)"></button>
                                        </td>
                                    </tr>
                                </ng-container>
                            </ng-template>
                        </p-table>
                    </div>

                    <button pButton label="Optional" class="cButton" style="display: inline-block; width: 20%"
                        type="button" icon="fa fa-plus" (click)="showDialog('optional')"></button>

                    <p-dialog [formGroup]="dialogForm" header="Add Optional Document" [(visible)]="oDisplay" [closable]="false"
                        [maximizable]="true" [width]="800">
                        <p-checkbox label="Does this document have conditions?" binary="true" formControlName="hasConditions"
                            (onChange)="toggleDocumentConditions($event)"></p-checkbox>
                        <div class="error-inline-msg">
                            <span *ngIf="dialogForm.get('hasConditions').disabled">
                                There are no existing checklist conditions
                            </span>
                        </div>

                        <br>

                        <ng-container *ngIf="dialogForm.get('hasConditions').enabled && dialogForm.get('hasConditions').value">
                            <h5>Conditions</h5>
                            <div formArrayName="conditions">
                                <div *ngFor="let condition of dialogForm.get('conditions').controls; let i=index">
                                    <div style="padding-top:1%" *ngIf="dialogForm.get('conditions')['length'] >= 0"
                                        [formGroupName]="i">
                                        <h6>Condition {{ i + 1 }}</h6>
                                        <div style="display: inline-block; margin-right:10px">
                                            <p-dropdown [options]="dropdownData.conditions" (onChange)="onDocumentConditionNameSelect($event.value, i)"
                                                placeholder="Select a condition" formControlName="conditionName"></p-dropdown>
                                        </div>
                                        <p-dropdown [options]="dropdownData.conditionOptions[i]" placeholder="Select a condition option"
                                            formControlName="conditionOption"></p-dropdown>
                                        <button pButton [disabled]="dialogForm.get('conditions')['length'] < 2" class="ui-button-danger"
                                            style="display: inline-block; width: 6%; margin-left: 2%" type="button"
                                            icon="fa fa-times" (click)="deleteDocumentCondition(i)"></button>
                                        <div class="error-inline-msg">
                                            <span *ngIf="dialogForm.get('conditions').get(i + '').get('conditionOption').dirty && dialogForm.get('conditions').get(i + '').get('conditionOption').hasError('isDuplicate')">
                                                Duplicate condition
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div style="padding-top:1%">
                                    <button pButton label="Add Condition" class="ui-button-success" style="display: inline-block; width: 35%"
                                        type="button" icon="fa fa-plus" (click)="addNewDocumentCondition()"></button>
                                </div>
                            </div>
                        </ng-container>

                        <h5>Agmt Code</h5>
                        <p-autoComplete [suggestions]="filteredAgmtCodes" (onSelect)="updateAgmtDocValues($event)"
                            (completeMethod)="searchAgmtCodes($event)" placeholder="Agmt Code" formControlName="agmtCode"
                            [style]="{'width':'90%', 'margin-bottom': '1%'}" [inputStyle]="{'width':'100%'}"
                            inputStyleClass="form-control"></p-autoComplete>
                        <div class="error-inline-msg">
                            <span *ngIf="dialogForm.get('agmtCode').dirty && dialogForm.get('agmtCode').hasError('isDuplicate')">
                                Duplicate agmt code
                            </span>
                        </div>

                        <h5>Document Name</h5>
                        <input type="text" id="input" class="form-control" placeholder="Document Name" formControlName="documentName"
                            required pInputText>

                        <div style="padding-top: 3%; padding-bottom: 4%">
                            <h5>Document Type</h5>
                            <p-dropdown [options]="documentTypeData" placeholder="Select a document type"
                                formControlName="documentType"></p-dropdown>
                        </div>

                        <h5>Remarks</h5>
                        <ngx-wig [formControl]="dialogForm.controls.remarks" [placeholder]="'Enter remarks here'"></ngx-wig>

                        <div class="ui-g" style="padding-right: 4%; padding-top: 2%; padding-bottom: 2%">
                            <p-checkbox label="Signature required" binary="true" formControlName="signature"></p-checkbox>
                        </div>
                        <div class="ui-g">
                            <p-checkbox label="Can be waived" binary="true" formControlName="canWaiver"></p-checkbox>
                        </div>

                        <div class="ui-g" style="padding-top:2%">
                            <button pButton label="Add" class="ui-button-success" style="display: inline-block; width: 20%; margin-right:4%"
                                type="button" icon="fa fa-plus" (click)="addNewDocument('optional')"></button>
                            <button pButton label="Cancel" class="ui-button-danger" style="display: inline-block; width: 20%"
                                type="button" icon="fa fa-minus" (click)="cancelAddNewDocument()"></button>
                        </div>
                    </p-dialog>

                    <p-dialog [formGroup]="dialogForm" header="Edit Optional Document" [(visible)]="oEditDisplay"
                        [closable]="false" [maximizable]="true" [width]="800">
                        <p-checkbox label="Does this document have conditions?" binary="true" formControlName="hasConditions"
                            (onChange)="toggleDocumentConditions($event)"></p-checkbox>
                        <div class="error-inline-msg">
                            <span *ngIf="dialogForm.get('hasConditions').disabled">
                                There are no existing checklist conditions
                            </span>
                        </div>

                        <br>

                        <ng-container *ngIf="dialogForm.get('hasConditions').enabled && dialogForm.get('hasConditions').value">
                            <h5>Conditions</h5>
                            <div formArrayName="conditions">
                                <div *ngFor="let condition of dialogForm.get('conditions').controls; let i=index">
                                    <div style="padding-top:1%" *ngIf="dialogForm.get('conditions')['length'] >= 0"
                                        [formGroupName]="i">
                                        <h6>Condition {{ i + 1 }}</h6>
                                        <div style="display: inline-block; margin-right:10px">
                                            <p-dropdown [options]="dropdownData.conditions" (onChange)="onDocumentConditionNameSelect($event.value, i)"
                                                placeholder="Select a condition" formControlName="conditionName"></p-dropdown>
                                        </div>
                                        <p-dropdown [options]="dropdownData.conditionOptions[i]" placeholder="Select a condition option"
                                            formControlName="conditionOption"></p-dropdown>
                                        <button pButton [disabled]="dialogForm.get('conditions')['length'] < 2" class="ui-button-danger"
                                            style="display: inline-block; width: 6%; margin-left: 2%" type="button"
                                            icon="fa fa-times" (click)="deleteDocumentCondition(i)"></button>
                                        <div class="error-inline-msg">
                                            <span *ngIf="dialogForm.get('conditions').get(i + '').get('conditionOption').dirty && dialogForm.get('conditions').get(i + '').get('conditionOption').hasError('isDuplicate')">
                                                Duplicate condition
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div style="padding-top:1%">
                                    <button pButton label="Add Condition" class="ui-button-success" style="display: inline-block; width: 35%"
                                        type="button" icon="fa fa-plus" (click)="addNewDocumentCondition()"></button>
                                </div>
                            </div>
                        </ng-container>

                        <h5>Agmt Code</h5>
                        <p-autoComplete [suggestions]="filteredAgmtCodes" (onSelect)="updateAgmtDocValues($event)"
                            (completeMethod)="searchAgmtCodes($event)" placeholder="Agmt Code" formControlName="agmtCode"
                            [style]="{'width':'90%', 'margin-bottom': '1%'}" [inputStyle]="{'width':'100%'}"
                            inputStyleClass="form-control"></p-autoComplete>
                        <div class="error-inline-msg">
                            <span *ngIf="dialogForm.get('agmtCode').dirty && dialogForm.get('agmtCode').hasError('isDuplicate')">
                                Duplicate agmt code
                            </span>
                        </div>

                        <h5>Document Name</h5>
                        <input type="text" id="input" class="form-control" placeholder="Document Name" formControlName="documentName"
                            required pInputText>

                        <div style="padding-top: 3%; padding-bottom: 4%">
                            <h5>Document Type</h5>
                            <p-dropdown [options]="documentTypeData" placeholder="Select a document type"
                                formControlName="documentType"></p-dropdown>
                        </div>

                        <h5>Remarks</h5>
                        <ngx-wig [formControl]="dialogForm.controls.remarks" [placeholder]="'Enter remarks here'"></ngx-wig>

                        <div class="ui-g" style="padding-right: 4%; padding-top: 2%; padding-bottom: 2%">
                            <p-checkbox label="Signature required" binary="true" formControlName="signature"></p-checkbox>
                        </div>
                        <div class="ui-g">
                            <p-checkbox label="Can be waived" binary="true" formControlName="canWaiver"></p-checkbox>
                        </div>

                        <div class="ui-g" style="padding-top:2%">
                            <button pButton label="Save" class="ui-button-success" style="display: inline-block; width: 20%; margin-right:4%"
                                type="button" icon="fa fa-plus" (click)="addNewDocument('optional')"></button>
                            <button pButton label="Cancel" class="ui-button-danger" style="display: inline-block; width: 20%"
                                type="button" icon="fa fa-minus" (click)="cancelAddNewDocument()"></button>
                        </div>
                    </p-dialog>
                </p-tabPanel>
            </p-tabView>
        </p-card>
    </div>
    <button pButton label="Create Checklist" class="ui-button-success" style="width: 100%" type="button" icon="fa fa-plus"
        [disabled]="processing" (click)="createChecklist()"></button>
</div>